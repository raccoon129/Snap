<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Snap.Paginas.PerfilPage"
             Title="Perfil">
    <Grid RowDefinitions="Auto,Auto,Auto,*">

        <!-- Línea separadora -->
        <BoxView Grid.Row="0"
                 HeightRequest="1"
                 Color="LightGray"
                 VerticalOptions="End" />
        <!-- Información de perfil -->
        <Grid Grid.Row="1"
              Padding="20"
              RowDefinitions="Auto,Auto,Auto">
            <HorizontalStackLayout HorizontalOptions="Center">
                <Frame HeightRequest="100"
                       WidthRequest="100"
                       CornerRadius="50"
                       IsClippedToBounds="True"
                       Padding="0">
                    <Image x:Name="ImgPerfil"
                           Aspect="AspectFill" />
                </Frame>
            </HorizontalStackLayout>
            <Label Grid.Row="1"
                   x:Name="LblNombreUsuario"
                   HorizontalOptions="Center"
                   FontSize="18"
                   FontAttributes="Bold"
                   Margin="0,10,0,0" />
            <Label Grid.Row="2"
                   x:Name="LblBiografia"
                   HorizontalOptions="Center"
                   FontSize="14"
                   MaxLines="2"
                   LineBreakMode="TailTruncation"
                   Margin="0,5,0,0" />
            <Button Grid.Row="2"
                    x:Name="BtnEditar"
                    Text="Editar"
                    HorizontalOptions="Center"
                    WidthRequest="100"
                    CornerRadius="15"
                    Margin="0,45,0,10"
                    Clicked="OnEditarClicked" />
        </Grid>
        <!-- Pestañas -->
        <Grid Grid.Row="2"
              ColumnDefinitions="*,*,*">
            <Button Grid.Column="0"
                    x:Name="BtnRecuerdos"
                    Text="Recuerdos"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource Primary}"
                    Clicked="OnRecuerdosClicked" />
            <Button Grid.Column="1"
                    x:Name="BtnFavoritos"
                    Text="Favoritos"
                    BackgroundColor="Transparent"
                    TextColor="Gray"
                    Clicked="OnFavoritosClicked" />
            <Button Grid.Column="2"
                    x:Name="BtnAjustes"
                    Text="Ajustes"
                    BackgroundColor="Transparent"
                    TextColor="Gray"
                    Clicked="OnAjustesClicked" />
            <!-- Indicador de pestaña activa -->
            <BoxView x:Name="IndicadorRecuerdos"
                     Grid.Column="0"
                     HeightRequest="2"
                     BackgroundColor="{StaticResource Primary}"
                     VerticalOptions="End" />
            <BoxView x:Name="IndicadorFavoritos"
                     Grid.Column="1"
                     HeightRequest="2"
                     BackgroundColor="Transparent"
                     VerticalOptions="End" />
            <BoxView x:Name="IndicadorAjustes"
                     Grid.Column="2"
                     HeightRequest="2"
                     BackgroundColor="Transparent"
                     VerticalOptions="End" />
        </Grid>
        <!-- Contenido según pestaña -->
        <Grid Grid.Row="3"
              x:Name="ContenidoPestanas">
            <!-- Vista de recuerdos -->
            <CollectionView x:Name="GridRecuerdos"
                            IsVisible="true"
                            SelectionMode="Single"
                            SelectionChanged="OnPublicacionSeleccionada">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="3"
                                     HorizontalItemSpacing="2"
                                     VerticalItemSpacing="2" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Image Source="{Binding UrlFoto}"
                               Aspect="AspectFill"
                               HeightRequest="120" />
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <!-- Vista de favoritos -->
            <CollectionView x:Name="GridFavoritos"
                            IsVisible="false"
                            SelectionMode="Single"
                            SelectionChanged="OnPublicacionSeleccionada">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="3"
                                     HorizontalItemSpacing="2"
                                     VerticalItemSpacing="2" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Image Source="{Binding UrlFoto}"
                               Aspect="AspectFill"
                               HeightRequest="120" />
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <!-- Vista de ajustes -->
            <StackLayout x:Name="ViewAjustes"
                         IsVisible="false"
                         Padding="20">
                <Label Text="Ajustes de perfil"
                       FontSize="20"
                       FontAttributes="Bold"
                       Margin="0,0,0,20" />
                <Button Text="Cambiar contraseña"
                        Margin="0,10" />
                <Button Text="Privacidad"
                        Margin="0,10" />
                <Button Text="Notificaciones"
                        Margin="0,10" />
                <Button Text="Cerrar sesión"
                        Margin="0,10"
                        BackgroundColor="Red"
                        TextColor="White"
                        Clicked="OnCerrarSesionClicked" />
            </StackLayout>
        </Grid>
    </Grid>
</ContentPage>